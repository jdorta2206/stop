rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Reglas para la colección 'rankings' (perfiles de jugador)
    match /rankings/{userId} {
      // Un usuario puede leer y escribir su propio perfil.
      allow read, write: if request.auth != null && request.auth.uid == userId;
      // Cualquier usuario autenticado puede leer (get) el perfil de otro.
      allow get: if request.auth != null;

      // Subcolección de amigos
      match /friends/{friendId} {
        // Solo el dueño del perfil puede gestionar su lista de amigos.
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Subcolección de notificaciones
      match /notifications/{notificationId} {
         // Solo el dueño del perfil puede leer y escribir sus notificaciones.
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // Subcolección de historial de partidas
      match /gameHistory/{gameId} {
        // Solo el dueño del perfil puede gestionar su historial.
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // Reglas para la colección 'rooms' (salas de juego)
    match /rooms/{roomId} {
      // Cualquiera puede leer los datos de una sala para unirse o ver el estado.
      allow read: if request.auth != null;
      // Un usuario autenticado puede crear una nueva sala.
      allow create: if request.auth != null;
      // Un usuario autenticado puede actualizar una sala (unirse, cambiar estado, etc.).
      allow update: if request.auth != null;
    }
  }
}
